import { Meta } from '@storybook/addon-docs/blocks';
import overlay from './data/test-coverage.json';
import React from 'react';
import TestCasesTable from '../../Decorators/_shared/TestCasesTable.jsx';

<Meta title="Testing/Behavior/Extends/Overview"/>

# Extends Functionality Testing

The `extends` functionality enables component inheritance and composition patterns in Stencil. This page documents the test coverage, patterns, generated components, and implementation status.

## Inheritance Patterns

- **Direct**: Component extends base class (`class Child extends Base`)
- **Multi-level**: Component -> Base -> GrandparentBase inheritance chains  
- **Abstract**: Component extends abstract base class with Stencil decorators
- **Mixin**: Component composes multiple behaviors via mixin functions

## Test Cases

Note: Test cases are high‑level scenarios covering inheritance patterns and composition behaviors. All extends tests reside under <code>test/wdio/ts-target/extends-*</code>.

export const ExtendsTestCasesTable = () => {
  // Pre-calculated test case status from JSON
  const testCaseStatus = overlay.testCaseStatus || {};
  
  // Test Case #1 data
  const case1 = testCaseStatus[1] || {};
  const case1Implemented = case1.implemented || false;
  const basicInheritanceCount = case1.componentCount || 0;

  // Stats calculation for inheritance group coverage
  const items = overlay.items || [];
  const inheritanceItems = items.filter(i => i.group === 'inheritance');
  const inheritance = {
    tested: inheritanceItems.filter(i => i.tested).length,
    total: inheritanceItems.length
  };

  const allRows = [
    {
      id: 1,
      implemented: case1Implemented,
      desc: 'Direct Inheritance (Component → LifecycleBase) - Tests comprehensive lifecycle event inheritance from a simple base class',
      types: (
        <>
          <strong>Load Lifecycle:</strong> componentWillLoad, componentDidLoad<br/>
          <strong>Render Lifecycle:</strong> componentWillRender, componentDidRender<br/>
          <strong>Update Lifecycle:</strong> componentWillUpdate, componentDidUpdate<br/>
          <small>Components: {basicInheritanceCount} | Uses Global Array Pattern | ES2022 Build Target</small>
        </>
      ),
      tested: inheritance.tested,
      total: inheritance.total,
      section: case1Implemented ? 'implemented' : 'missing',
    }
  ];

  return <TestCasesTable rows={allRows} previewCount={1} />;
};

<ExtendsTestCasesTable />

export const ExtendsCoverageSummary = () => {
  const items = overlay.items || [];
  const totalComponents = items.length;
  const testedComponents = items.filter(item => item.tested).length;
  const coveragePercentage = totalComponents > 0 ? Math.round((testedComponents / totalComponents) * 100) : 0;
  
  const testCases = Object.values(overlay.testCaseStatus || {});
  const implementedCases = testCases.filter(tc => tc.implemented).length;
  const totalCases = testCases.length;
  
  return (
    <div style={{ background: '#f8f9fa', padding: '16px', borderRadius: '8px', marginBottom: '24px' }}>
      <h3 style={{ margin: '0 0 12px 0' }}>Coverage Status</h3>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>
        <div>
          <strong>Component Coverage</strong><br/>
          <span style={{ fontSize: '24px', color: coveragePercentage === 100 ? '#16a34a' : '#f59e0b' }}>
            {testedComponents}/{totalComponents} ({coveragePercentage}%)
          </span>
        </div>
        <div>
          <strong>Test Cases</strong><br/>
          <span style={{ fontSize: '24px', color: implementedCases === totalCases ? '#16a34a' : '#f59e0b' }}>
            {implementedCases}/{totalCases} implemented
          </span>
        </div>
        <div>
          <strong>Status</strong><br/>
          <span style={{ 
            fontSize: '14px', 
            padding: '4px 8px', 
            borderRadius: '12px',
            background: coveragePercentage >= 80 ? '#16a34a' : '#f59e0b',
            color: '#fff'
          }}>
            {coveragePercentage >= 80 ? 'GOOD' : 'IN PROGRESS'}
          </span>
        </div>
      </div>
    </div>
  );
};

<ExtendsCoverageSummary />

## Next Steps

1. ✅ **Test Case #1 Complete**: Lifecycle inheritance fully implemented and tested (6/6 passing tests)
2. **Expand Test Cases**: Build upon this foundation to add more inheritance patterns:
   - Parent-child component hierarchies
   - Multi-level inheritance chains (Component → Base → GrandparentBase) 
   - Property and state inheritance with @Prop/@State decorators
   - Mixin composition and behavior merging

## Related Documentation

- [Extends Evaluation](?path=/docs/testing-behavior-extends-extends-evaluation--docs) - Detailed evaluation and planning
- [Historical Context](?path=/docs/testing-behavior-extends-historical-controller-context--docs) - Background on @Controller proposal
