import { Meta } from '@storybook/addon-docs/blocks';
import overlay from './data/test-coverage.json';
import React from 'react';
import TestCasesTable from '../../Decorators/_shared/TestCasesTable.jsx';

<Meta title="Testing/Behavior/Extends/Overview"/>

# Extends Functionality Testing

The `extends` functionality enables component inheritance and composition patterns in Stencil. This page documents the test coverage, patterns, generated components, and implementation status.

## Inheritance Patterns

- **Direct**: Component extends base class (`class Child extends Base`)
- **Multi-level**: Component -> Base -> GrandparentBase inheritance chains  
- **Abstract**: Component extends abstract base class with Stencil decorators
- **Mixin**: Component composes multiple behaviors via mixin functions

## Test Cases

Test cases are organized by **complexity** - from basic inheritance patterns to advanced real-world reactive controllers. All `extends` tests reside under <code>test/wdio/ts-target/extends-*</code>.

export const ExtendsCoverageSummary = () => {
  const items = overlay.items || [];
  const totalComponents = items.length;
  const testedComponents = items.filter(item => item.tested).length;
  const coveragePercentage = totalComponents > 0 ? Math.round((testedComponents / totalComponents) * 100) : 0;
  
  const testCases = Object.values(overlay.testCaseStatus || {});
  const implementedCases = testCases.filter(tc => tc.implemented).length;
  const totalCases = testCases.length;
  
  return (
    <div style={{ background: '#f8f9fa', padding: '16px', borderRadius: '8px', marginBottom: '24px' }}>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>
        <div>
          <strong>Component Coverage</strong><br/>
          <span style={{ fontSize: '24px', color: coveragePercentage === 100 ? '#16a34a' : '#f59e0b' }}>
            {testedComponents}/{totalComponents} ({coveragePercentage}%)
          </span>
        </div>
        <div>
          <strong>Test Cases</strong><br/>
          <span style={{ fontSize: '24px', color: implementedCases === totalCases ? '#16a34a' : '#f59e0b' }}>
            {implementedCases}/{totalCases} implemented
          </span>
        </div>
        <div>
          <strong>Status</strong><br/>
          <span style={{ 
            fontSize: '14px', 
            padding: '4px 8px', 
            borderRadius: '12px',
            background: coveragePercentage >= 80 ? '#16a34a' : '#f59e0b',
            color: '#fff'
          }}>
            {coveragePercentage >= 80 ? 'GOOD' : 'IN PROGRESS'}
          </span>
        </div>
      </div>
    </div>
  );
};

<ExtendsCoverageSummary />


### **ðŸŸ¢ Basic Inheritance (1-5)**
Foundation patterns for lifecycle inheritance, property/state basics, method inheritance, and render composition.

### **ðŸŸ¡ Standard Patterns (6-11)** 
Common inheritance scenarios including abstract classes, component-to-component, external libraries, mixins, event handling, and watch decorators.

export const ExtendsTestCasesTable = () => {
  // Pre-calculated test case status from JSON
  const testCaseStatus = overlay.testCaseStatus || {};
  const items = overlay.items || [];
  
  // Helper function to get stats for a group
  const getGroupStats = (groupName) => {
    const groupItems = items.filter(i => i.group === groupName);
    return {
      tested: groupItems.filter(i => i.tested).length,
      total: groupItems.length
    };
  };

  const allRows = [
    // ðŸŸ¢ Basic Inheritance (1-2)
    {
      id: 1,
      implemented: testCaseStatus[1]?.implemented || false,
      desc: testCaseStatus[1]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¢ Basic:</strong> Foundation lifecycle inheritance pattern<br/>
          <strong>Coverage:</strong> componentWillLoad, componentDidLoad, componentWillRender, componentDidRender, componentWillUpdate, componentDidUpdate<br/>
          <small>Uses Global Array Pattern | ES2022 Build Target | 6 passing tests</small>
        </>
      ),
      tested: getGroupStats('lifecycle').tested,
      total: getGroupStats('lifecycle').total,
      section: testCaseStatus[1]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 2,
      implemented: testCaseStatus[2]?.implemented || false,
      desc: testCaseStatus[2]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¢ Basic:</strong> Multi-level inheritance chains (Component â†’ ParentBase â†’ GrandparentBase)<br/>
          <strong>Advanced Features:</strong> super() call chains, event ordering, inheritance chain integrity<br/>
          <small>Uses Global Array Pattern | ES2022 Build Target | 7 passing tests</small>
        </>
      ),
      tested: getGroupStats('multilevel').tested,
      total: getGroupStats('multilevel').total,
      section: testCaseStatus[2]?.implemented ? 'implemented' : 'missing',
    },
    // ðŸŸ¡ Standard Patterns (3-6)
    {
      id: 3,
      implemented: testCaseStatus[3]?.implemented || false,
      desc: testCaseStatus[3]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend Stencil-decorated abstract base classes<br/>
          <strong>Property Inheritance:</strong> @Prop, @State, @Method inheritance<br/>
          <small>Smoke tests for basic extends functionality</small>
        </>
      ),
      tested: getGroupStats('abstract').tested,
      total: getGroupStats('abstract').total,
      section: testCaseStatus[3]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 4,
      implemented: testCaseStatus[4]?.implemented || false,
      desc: testCaseStatus[4]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend other component classes<br/>
          <strong>Property Inheritance:</strong> @Prop, @State, @Method inheritance<br/>
          <small>Smoke tests for component-to-component inheritance</small>
        </>
      ),
      tested: getGroupStats('component').tested,
      total: getGroupStats('component').total,
      section: testCaseStatus[4]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 5,
      implemented: testCaseStatus[5]?.implemented || false,
      desc: testCaseStatus[5]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend classes from external Stencil projects<br/>
          <strong>Cross-Package Inheritance:</strong> test-sibling library integration<br/>
          <small>Smoke tests for external library inheritance</small>
        </>
      ),
      tested: getGroupStats('external').tested,
      total: getGroupStats('external').total,
      section: testCaseStatus[5]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 6,
      implemented: testCaseStatus[6]?.implemented || false,
      desc: testCaseStatus[6]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend via Stencil Mixin function<br/>
          <strong>Behavior Composition:</strong> Multiple behaviors composed into single component<br/>
          <small>Smoke tests for mixin-based composition</small>
        </>
      ),
      tested: getGroupStats('abstract').tested,
      total: getGroupStats('abstract').total,
      section: testCaseStatus[6]?.implemented ? 'implemented' : 'missing',
    },
    // ðŸŸ¢ Basic Inheritance (3-5)
    {
      id: 3,
      implemented: testCaseStatus[3]?.implemented || false,
      desc: testCaseStatus[3]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¢ Basic:</strong> Property & State inheritance basics - @Prop and @State without conflicts<br/>
          <strong>Foundation Features:</strong> @Prop inheritance, @State inheritance, additional properties, property reactivity<br/>
          <small>Basic property passing and rendering | No conflicts | Foundation for complex scenarios</small>
        </>
      ),
      tested: getGroupStats('props-state').tested,
      total: getGroupStats('props-state').total,
      section: testCaseStatus[3]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 4,
      implemented: testCaseStatus[4]?.implemented || false,
      desc: testCaseStatus[4]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¢ Basic:</strong> Method inheritance basics - @Method inheritance and super() calls<br/>
          <strong>Foundation Features:</strong> @Method inheritance, super() calls, method override, method composition<br/>
          <small>Basic method exposure | Parent method invocation | Foundation for complex methods</small>
        </>
      ),
      tested: getGroupStats('methods').tested,
      total: getGroupStats('methods').total,
      section: testCaseStatus[4]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 5,
      implemented: testCaseStatus[5]?.implemented || false,
      desc: testCaseStatus[5]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¢ Basic:</strong> Render method inheritance - Basic render() inheritance and template composition<br/>
          <strong>Foundation Features:</strong> Render inheritance, template composition, slot integration, CSS class inheritance<br/>
          <small>Parent template inclusion | Template composition | Foundation for complex rendering</small>
        </>
      ),
      tested: getGroupStats('render').tested,
      total: getGroupStats('render').total,
      section: testCaseStatus[5]?.implemented ? 'implemented' : 'missing',
    },
    // ðŸŸ¡ Standard Patterns (6-11)
    {
      id: 6,
      implemented: testCaseStatus[6]?.implemented || false,
      desc: testCaseStatus[6]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend Stencil-decorated abstract base classes<br/>
          <strong>Property Inheritance:</strong> @Prop, @State, @Method inheritance<br/>
          <small>Smoke tests for basic extends functionality</small>
        </>
      ),
      tested: getGroupStats('abstract').tested,
      total: getGroupStats('abstract').total,
      section: testCaseStatus[6]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 7,
      implemented: testCaseStatus[7]?.implemented || false,
      desc: testCaseStatus[7]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend other component classes<br/>
          <strong>Property Inheritance:</strong> @Prop, @State, @Method inheritance<br/>
          <small>Smoke tests for component-to-component inheritance</small>
        </>
      ),
      tested: getGroupStats('component').tested,
      total: getGroupStats('component').total,
      section: testCaseStatus[7]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 8,
      implemented: testCaseStatus[8]?.implemented || false,
      desc: testCaseStatus[8]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend classes from external Stencil projects<br/>
          <strong>Cross-Package Inheritance:</strong> test-sibling library integration<br/>
          <small>Smoke tests for external library inheritance</small>
        </>
      ),
      tested: getGroupStats('external').tested,
      total: getGroupStats('external').total,
      section: testCaseStatus[8]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 9,
      implemented: testCaseStatus[9]?.implemented || false,
      desc: testCaseStatus[9]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Components extend via Stencil Mixin function<br/>
          <strong>Behavior Composition:</strong> Multiple behaviors composed into single component<br/>
          <small>Smoke tests for mixin-based composition</small>
        </>
      ),
      tested: getGroupStats('mixin').tested,
      total: getGroupStats('mixin').total,
      section: testCaseStatus[9]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 10,
      implemented: testCaseStatus[10]?.implemented || false,
      desc: testCaseStatus[10]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Event handling inheritance - @Listen decorators and event propagation<br/>
          <strong>Event Features:</strong> Multiple @Listen decorators, event bubbling, global vs local listeners, handler override<br/>
          <small>Core interactive functionality | Event handling order and precedence | Component event behavior</small>
        </>
      ),
      tested: getGroupStats('events').tested,
      total: getGroupStats('events').total,
      section: testCaseStatus[10]?.implemented ? 'implemented' : 'missing',
    },
    {
      id: 11,
      implemented: testCaseStatus[11]?.implemented || false,
      desc: testCaseStatus[11]?.description || '',
      types: (
        <>
          <strong>ðŸŸ¡ Standard:</strong> Watch decorator inheritance - @Watch behavior through inheritance chains<br/>
          <strong>Reactive Features:</strong> Multiple @Watch decorators, execution order, reactive property chains, handler override<br/>
          <small>Core reactive functionality | Property watching behavior | Reactive pattern inheritance</small>
        </>
      ),
      tested: getGroupStats('watch').tested,
      total: getGroupStats('watch').total,
      section: testCaseStatus[11]?.implemented ? 'implemented' : 'missing',
    }
  ];

  return <TestCasesTable rows={allRows} previewCount={3} />;
};

<ExtendsTestCasesTable />


## Next Steps

**ðŸŸ¢ Basic Inheritance (2/5 Complete):**
1. âœ… **Test Case #1**: Lifecycle inheritance fully implemented (6 passing tests)
2. âœ… **Test Case #2**: Multi-level lifecycle inheritance fully implemented (7 passing tests)
3. **ðŸ“‹ Test Case #3 TODO**: Property & State Inheritance Basics - @Prop and @State without conflicts
4. **ðŸ“‹ Test Case #4 TODO**: Method Inheritance Basics - @Method inheritance and super() calls
5. **ðŸ“‹ Test Case #5 TODO**: Render Method Inheritance - Basic render() inheritance and template composition

**ðŸŸ¡ Standard Patterns (4/6 Complete):**
6. âœ… **Test Case #6**: Abstract base class inheritance (smoke tests)
7. âœ… **Test Case #7**: Component-to-component inheritance (smoke tests)
8. âœ… **Test Case #8**: External library inheritance (smoke tests) 
9. âœ… **Test Case #9**: Mixin composition (smoke tests)
10. **ðŸ“‹ Test Case #10 TODO**: Event Handling Inheritance - @Listen decorators and event propagation
11. **ðŸ“‹ Test Case #11 TODO**: Watch Decorator Inheritance - @Watch behavior through inheritance chains

**Next Steps:**
   - **Test Cases #3-5**: Complete foundational Basic Inheritance patterns (Properties, Methods, Render)
   - **Test Cases #10-11**: Core decorator inheritance (Event handling, Watch decorators)
   - **Advanced Real-World Controllers**: Implement production-ready reactive controller examples demonstrating real business value
   - **Robustness & Production**: Add decorator conflicts, compiler behavior, SSR/hydration, and production-critical edge cases
