import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Testing/Decorators/@Component Coverage Strategy" tags={['ai','coverage','stable']} />

# @Component Decorator Coverage Strategy

This document outlines the approach to achieve and maintain 100% coverage for valid `@Component` permutations as defined by `Testing/Decorators/component-coverage.js`.

## Source of Truth
- Coverage data: `Testing/Decorators/component-coverage-data.json`
- Script: `Testing/Decorators/component-coverage.js`
- Matrix location: `test/wdio/component-decorator/matrix/`

## Options & Valid States
- Options order: `[shadow, scoped, assetsDirs, formAssociated, styleUrl, styleUrls, styles]`
- Symbols: `✓` (true/set), `✗` (false), `-` (absent)
- Style exclusivity: At most one of `styleUrl`, `styleUrls`, or `styles` may be set per component.

Valid style states:
- `[✓, -, -]`  → `styleUrl`
- `[-, ✓, -]`  → `styleUrls`
- `[-, -, ✓]`  → `styles`
- `[-, -, -]`  → none

## Rules
- Shadow and Scoped are mutually exclusive; do not set both to true.
- Exactly one file per unique permutation.
- Names: `cmp-*` or `component-*`, placed in `matrix/`.

## Standardized Assets
- `styleUrl`: `'matrix-gen.css'`
- `styleUrls`: `['matrix-gen.css', 'matrix-alt.css']`
- `styles`: `':host{display:block}'`

## Workflow (.ai scripts)
From `test/storybook/docs/.ai/testing`:
- `npm run coverage-component-tests` → refresh coverage JSON
- `npm run generate-missing-components` → fill gaps under `matrix/`
- `npm run coverage-component-tests` → confirm 100%
- `npm run build-wdio-components` → build WDIO project

## Status (2025-09-08)
- Covered: 192/192 (100.0%)
- .tsx count under `test/wdio/component-decorator/**` equals covered (192)
- Imports normalized to `import { Component, h } from '@stencil/core'`
- Invalid permutations pruned; exclusivity enforced
- Generator emits one file per missing permutation with `cmp-` prefix

## Verification Guardrails
- Parity check: `.tsx` count must equal `coverage.covered`
- No files setting multiple style props
- No `shadow:true` + `scoped:true`

## Troubleshooting
- If WDIO build fails due to missing CSS, ensure `matrix-gen.css` and `matrix-alt.css` exist in `matrix/`.
- If coverage dips, search for invalid permutations or duplicate files.
```
