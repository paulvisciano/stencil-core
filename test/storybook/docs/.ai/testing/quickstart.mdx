import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Testing/Framework/Quickstart" tags={['ai','coverage','stable']} />

# Quickstart: Matrix → Generate → Build → Update Rules → Regenerate → Rebuild → Verify

A concise, repeatable loop to reach Phase 1 (compile‑only) and then proceed to Phase 2 tests.

## Source of truth
- Rules JSON (per decorator): e.g., `Testing/Decorators/Component/rules.json`
- Coverage output (per decorator): e.g., `Testing/Decorators/Component/coverage-data.json`
- Generated artifacts (per decorator): e.g., `test/wdio/component-decorator/matrix/{shadow,scoped,light}/`

## Phase 1 loop (from `.ai/testing`)
1. Generate components for all permutations (and refresh coverage around generation)
   - `npm run coverage-loop` (alias for per‑decorator generate loops)
2. Build components to discover invalid permutations (rules discovery)
   - `npm run build-wdio-components`
   - Fixes are driven by compiler errors
3. Update rules to encode constraints discovered by the compiler
   - Edit the active decorator’s `rules.json`
4. Refresh matrix and regenerate components from updated rules
   - `npm run coverage-loop`
5. Rebuild until the build passes cleanly
   - `npm run build-wdio-components`
6. Verify matrix integrity (scripted guard) and write overlays
   - `npm run <decorator>:verify-matrix`

At this point, Phase 1 (compile‑only) is complete.

## Phase 2 (tests)
7. Create and propagate WDIO tests across applicable generated components
   - `npm run run-component-tests`
   - Use overlays to surface `tested` markers in docs

## Guardrails enforced by verify
- Re‑runs coverage and requires 100% compile coverage per decorator
- Parity: `.tsx` count under each `test/wdio/<decorator>/matrix/**` equals `coverage-data.json.coverage.covered`
- Grouping and exclusivity validated from `rules.json`
- Builds `coverage-overlay.json` (`tested`/`testedBy`)

## Tips
- The generator reads coverage data; always refresh coverage after changing rules.
- Prefer running from `.ai/testing` using script shortcuts.
- Optional probe (component): `VERIFY_PROBE_ENCAPSULATION=1 npm run component:verify-matrix`
