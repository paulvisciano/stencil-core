import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Testing/Framework/Quickstart" tags={['ai','coverage','stable']} />

# Quickstart: Coverage → Generate → Verify

A concise, repeatable loop to maintain 100% coverage of valid decorator permutations, driven by a single rules file.

## Source of truth
- Rules JSON (per decorator): e.g., `Testing/Decorators/component-rules.json`
- Coverage output (per decorator): e.g., `Testing/Decorators/component-coverage-data.json`
- Generated artifacts (per decorator): e.g., `test/wdio/component-decorator/matrix/{shadow,scoped,light}/`

## One-pass loop (from `.ai/testing`)
1. Refresh coverage, generate any missing, refresh again
   - `npm run coverage-loop`
2. Verify matrix integrity (coverage parity, grouping, exclusivity) BEFORE building (for the active decorator)
   - `npm run verify-matrix` (for @Component; use the corresponding verify step per decorator)
3. Build the WDIO components
   - `npm run build-wdio-components`
4. Run component tests (or target a spec)
   - `npm run run-component-tests`
   - `npm run run-component-tests:spec -- ./<decorator>/**/*.test.tsx` (e.g., `./component-decorator/**/*.test.tsx`)

## When rules change or compiler errors occur
- Preferred (one-liner to sync data and files):
  - `npm run coverage-loop` (refresh → generate → refresh)
- Verify early:
  - `npm run verify-matrix` (for @Component; use the corresponding verify step per decorator)
- If the build reports compiler errors after you generate components:
  - Tweak the rules JSON for the active decorator (e.g., `component-rules.json`) to correct the permutation space or exclusivity
  - Re-run `npm run coverage-loop`
  - Re-run `npm run verify-matrix`
  - Once the matrix verifies cleanly, build again with `npm run build-wdio-components`
  - Then move on to tests
- Optional sanity check (prove rule-driven growth):
  - `VERIFY_PROBE_ENCAPSULATION=1 npm run verify-matrix`

## Guardrails enforced
For @Component (example):
- Exclusivity: exactly one of `styleUrl | styleUrls | styles` (or none). Shadow and scoped cannot both be true.
- Parity: total `.tsx` files under the decorator folder must equal `coverage.covered`.
- Grouping: files live under `matrix/{shadow|scoped|light}/` with parent‑relative CSS paths.

For other decorators, use their rules JSON to define validity/exclusivity and apply the same loop.

## Tips
- The generator reads coverage JSON (not rules). Always refresh coverage after changing rules.
- The coverage script derives the permutation space directly from the rules JSON.

This is the fastest path to keep the matrix healthy and at 100%.
